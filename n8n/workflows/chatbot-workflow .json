{
  "name": "chatbot-workflow",
  "nodes": [
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d058bf66-1c0f-48d1-933e-e09214ac3e45",
              "name": "resposta_chatbot",
              "value": "={{$json.choices[0].message.content}}",
              "type": "string"
            },
            {
              "id": "ab7a7ce3-3298-4223-bdce-6c39f06a0cd8",
              "name": "last_question",
              "value": "complementary_question",
              "type": "string"
            },
            {
              "id": "276b6d57-3f8d-426c-9c3f-c39735d5dfa7",
              "name": "status",
              "value": "collecting_complementary",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
<<<<<<< HEAD
      "id": "5082e440-43f7-4980-8c6d-6b77e74acd41",
=======
      "id": "30ffaed8-e7fe-4e6f-a8d8-30b4e10ad398",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Set Complementary Question",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
<<<<<<< HEAD
        656,
        -208
=======
        -656,
        16
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.status}}",
              "value2": "collecting_complementary"
            }
          ]
        }
      },
<<<<<<< HEAD
      "id": "2eeec1d9-047a-475a-9d2d-a2019b9317a8",
=======
      "id": "54c84956-5091-4639-a32b-10f3eaf4031d",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Is Status Collecting Complementary?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
<<<<<<< HEAD
        16,
        -768
=======
        -1296,
        -544
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
<<<<<<< HEAD
        192,
        80
      ],
      "id": "596beee0-413a-4af1-8b28-362e8ee26b9a",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "nb0EGt3gd2OI0bf7",
=======
        -1120,
        304
      ],
      "id": "249d3560-0a32-4c7c-bdbc-4b044f4fd0bd",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "ZUu2KqMWXWFfDZlm",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.body.message }}",
        "messages": {
          "messageValues": [
            {
<<<<<<< HEAD
              "message": "Você é um assistente especialista da Avanade. Seu objetivo é coletar informações detalhadas para a criação de um Business Case. Você receberá o histórico de uma conversa que já começou, onde algumas informações básicas já foram coletadas. Sua tarefa é analisar o histórico e fazer perguntas complementares, uma de cada vez, para aprofundar o entendimento sobre o problema, os objetivos e o contexto do cliente. Seja objetivo e profissional. IMPORTANTE: Quando você julgar que já possui todas as informações necessárias e não há mais perguntas a serem feitas, responda ÚNICA E EXCLUSIVAMENTE com a palavra: COMPLETO"
=======
              "message": "Você é um assistente especialista da Avanade. Seu objetivo é coletar informações detalhadas para a criação de um Business Case.  Você receberá o histórico de uma conversa que já começou, onde algumas informações básicas já foram coletadas. Sua tarefa é analisar o histórico e fazer perguntas complementares, uma de cada vez, para aprofundar o entendimento sobre o problema, os objetivos e o contexto do cliente.  Seja objetivo e profissional.  IMPORTANTE: Quando você julgar que já possui todas as informações necessárias e não há mais perguntas a serem feitas, responda ÚNICA E EXCLUSIVAMENTE com a palavra: COMPLETO"
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
            },
            {
              "type": "AIMessagePromptTemplate",
              "message": "={{ $json.history.map(item => `${item.role}: ${item.content}`).join('\\n') }}"
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
<<<<<<< HEAD
        192,
        -64
      ],
      "id": "b606ec4c-1dd9-4dd2-bc41-f15abcd824cd",
=======
        -1120,
        160
      ],
      "id": "0405cd44-701d-4631-9514-f68a584979cf",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Basic LLM Chain"
    },
    {
      "parameters": {
        "operation": "get",
        "key": "=session:{{ $json.body.sessionId }}",
        "options": {}
      },
<<<<<<< HEAD
      "id": "e2f62845-3214-4a34-ac77-6233b091ec3a",
=======
      "id": "e44089bf-2c41-482f-9846-f5c3b1abf418",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Get Session from Redis",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
<<<<<<< HEAD
        -864,
        -960
      ],
      "credentials": {
        "redis": {
          "id": "M3DtzNe7LLLXzOoq",
=======
        -2176,
        -736
      ],
      "credentials": {
        "redis": {
          "id": "wb7teCLx0cJygs7C",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json.data}}",
              "operation": "isEmpty"
            }
          ]
        }
      },
<<<<<<< HEAD
      "id": "b2752b52-79d1-424a-85aa-9f0a2abca762",
=======
      "id": "75ba5f20-16d7-49d5-bf93-154190901b7f",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Is New Conversation?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
<<<<<<< HEAD
        -528,
        -960
=======
        -1840,
        -736
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ]
    },
    {
      "parameters": {
        "operation": "set",
        "key": "=session:{{ $json.body.sessionId }}",
        "value": "={{ JSON.stringify($json) }}"
      },
<<<<<<< HEAD
      "id": "5b276421-1be3-4038-923f-1c02683f66ac",
=======
      "id": "028b58e6-b7c0-40fc-b5c3-660ee8af3496",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Save Session to Redis",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
<<<<<<< HEAD
        1216,
        -544
      ],
      "credentials": {
        "redis": {
          "id": "M3DtzNe7LLLXzOoq",
=======
        -96,
        -320
      ],
      "credentials": {
        "redis": {
          "id": "wb7teCLx0cJygs7C",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "mode": "mergeByPosition",
        "options": {}
      },
<<<<<<< HEAD
      "id": "df3259f0-a667-438d-9bdf-0d947a2d7929",
=======
      "id": "dfb90bb2-d597-4e7d-8e2b-2320f7012bbb",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Merge",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [
<<<<<<< HEAD
        928,
        -544
=======
        -384,
        -320
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "ccf53580-f5a6-4a5d-b892-297c1d769661",
              "name": "resposta_chatbot",
              "value": "Excelente. E qual o principal resultado que vocês esperam alcançar com a solução deste problema?",
              "type": "string"
            },
            {
              "id": "060a4f5f-f61b-426c-941f-506e78864708",
              "name": "last_question",
              "value": "resultado_esperado",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
<<<<<<< HEAD
      "id": "c55d3a60-e465-44c5-8138-d356c80c7ee7",
=======
      "id": "df260871-88db-44e0-919e-b5e61a9d4ff4",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Ask Resultado",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
<<<<<<< HEAD
        480,
        -560
=======
        -832,
        -336
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "52e259b3-4f9e-4e4b-bb66-7b89d41fd2ee",
              "name": "resposta_chatbot",
              "value": "Ok. Agora, por favor, descreva o problema ou desafio que vocês estão enfrentando.",
              "type": "string"
            },
            {
              "id": "28ed46a3-c5eb-4a25-a226-9fde56a65df2",
              "name": "last_question",
              "value": "problema_atual",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
<<<<<<< HEAD
      "id": "4848cc5f-4f8c-4a70-ae7d-3f796a56e01b",
=======
      "id": "c1232aff-0fc7-4851-8339-a42746638862",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Ask Problema",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
<<<<<<< HEAD
        480,
        -704
=======
        -832,
        -480
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "18f91040-ec38-4e89-a2ba-c71d604e339c",
              "name": "resposta_chatbot",
              "value": "Certo. Qual é o tamanho da empresa (ex: pequena, média, grande)?",
              "type": "string"
            },
            {
              "id": "1c7a8da3-5cf3-4856-bb61-c884acbf1f92",
              "name": "last_question",
              "value": "tamanho",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
<<<<<<< HEAD
      "id": "8da8f231-9c70-4f13-8493-cf60ce231982",
=======
      "id": "7e417589-c956-4919-b197-4825d51ec14f",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Ask Tamanho",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
<<<<<<< HEAD
        480,
        -864
=======
        -832,
        -640
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "722f986d-141a-45c1-90a8-b64161a49f53",
              "name": "resposta_chatbot",
              "value": "Entendido. E qual é o setor de atuação da empresa?",
              "type": "string"
            },
            {
              "id": "895c2560-6c6a-4972-871d-f8d29bb73a8a",
              "name": "last_question",
              "value": "setor",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
<<<<<<< HEAD
      "id": "e20b9827-c5d5-4205-863a-2c5f2780c957",
=======
      "id": "cca4823c-67d5-4044-9757-c62ae8f608fe",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Ask Setor",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
<<<<<<< HEAD
        480,
        -1024
=======
        -832,
        -800
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ]
    },
    {
      "parameters": {
        "jsCode": "const sessionData = $json.session_data; \nconst lastQuestion = sessionData.last_question;\nconst userAnswer = $json.body.message;\n\n// Update the collected_data with the user's last answer\nif (lastQuestion && sessionData.collected_data.hasOwnProperty(lastQuestion)) {\n  sessionData.collected_data[lastQuestion] = userAnswer;\n} else if (lastQuestion === 'complementary_question') {\n  // Handle the answer to the AI's question if needed, e.g., save it to a new field\n  sessionData.collected_data.complementary_answer = userAnswer;\n}\n\n// Add the user's answer to the history\nsessionData.history.push({ role: 'user', content: userAnswer });\n\nreturn sessionData;"
      },
<<<<<<< HEAD
      "id": "c6603787-6701-41e2-ad48-46c8a9bb98c9",
=======
      "id": "5fbd2174-e1f2-46c4-9e8e-b2ea00c8a402",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Update with Answer",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
<<<<<<< HEAD
        -160,
        -768
=======
        -1472,
        -544
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1c742308-f468-45da-901d-531e285d8366",
              "name": "resposta_chatbot",
              "value": "Olá! Sou o assistente da Avanade para criação de Business Cases. Para começarmos, qual o nome da sua empresa?",
              "type": "string"
            },
            {
              "id": "90d1f76d-0d6c-48c2-a9b0-95b77e382d33",
              "name": "status",
              "value": "collecting",
              "type": "string"
            },
            {
              "id": "31f4a9f9-51ab-43f6-9c4c-31a89fd59e51",
              "name": "last_question",
              "value": "nome_empresa",
              "type": "string"
            },
            {
              "id": "22998a4d-f7c8-472e-8395-e5fc1760c6d9",
              "name": "collected_data",
              "value": "={{ { \"nome_empresa\": null, \"setor\": null, \"tamanho\": null, \"problema_atual\": null, \"resultado_esperado\": null } }}",
              "type": "json"
            },
            {
              "id": "df4ab229-4d64-4e20-96f8-98e94a129d2b",
              "name": "history",
              "value": "=[{ \"role\": \"assistant\", \"content\": \"Olá! Sou o assistente da Avanade...\" }]",
              "type": "json"
            },
            {
              "id": "sessionid-new",
              "name": "sessionId",
              "value": "={{ $json.body.sessionId }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
<<<<<<< HEAD
      "id": "75940bf3-5cc9-426c-9634-f16d03ef326e",
=======
      "id": "7d551282-bc01-43b6-8fc1-a6249d482f76",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Create Session and Ask First Question",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
<<<<<<< HEAD
        -336,
        -576
=======
        -1648,
        -352
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json.collected_data.setor === null}}",
              "value2": true
            }
          ]
        }
      },
<<<<<<< HEAD
      "id": "e53b6f7e-4504-4ca8-b7dd-f5386ab85c03",
=======
      "id": "eafc7327-ad76-482a-8456-ef0c4939cfb6",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Check Setor",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
<<<<<<< HEAD
        224,
        -880
=======
        -1088,
        -656
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json.collected_data.tamanho === null}}",
              "value2": true
            }
          ]
        }
      },
<<<<<<< HEAD
      "id": "9482e36a-2330-4008-9b6d-a0d79609ff68",
=======
      "id": "487bba99-f326-489a-92ef-d9ee96cd1ac7",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Check Tamanho",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
<<<<<<< HEAD
        224,
        -752
=======
        -1088,
        -528
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json.collected_data.problema_atual === null}}",
              "value2": true
            }
          ]
        }
      },
<<<<<<< HEAD
      "id": "97c4ec5e-c366-4a35-8edb-d0526201c52f",
=======
      "id": "d531ac96-7b72-4d79-819e-31f7f00746f3",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Check Problema",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
<<<<<<< HEAD
        224,
        -608
=======
        -1088,
        -384
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json.collected_data.resultado_esperado === null}}",
              "value2": true
            }
          ]
        }
      },
<<<<<<< HEAD
      "id": "63256b4b-0005-42d2-ba45-ca89eafe4487",
=======
      "id": "3c433266-a410-41e4-b177-185fbf9a41b8",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Check Resultado",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
<<<<<<< HEAD
        -80,
        -32
=======
        -1392,
        192
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "chatbot-conversa",
        "responseMode": "lastNode",
        "options": {}
      },
<<<<<<< HEAD
      "id": "9c394828-a544-490d-85e9-bdfbe4deada4",
=======
      "id": "b817f073-4bef-41f2-bc23-17ca0f85b780",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Webhook1",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
<<<<<<< HEAD
        -1536,
        -720
=======
        -2848,
        -496
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ],
      "webhookId": "124abe21-dc85-40a8-8213-f55acafdb4c6"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "access-key-extract",
              "name": "access_key",
              "value": "={{ $json.body['access-key'] || $json.body.accessKey }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
<<<<<<< HEAD
      "id": "e3321c32-aee9-4922-b0c4-dba61c45f68e",
=======
      "id": "dfe33ccc-d016-474f-93bd-480039208708",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Extract Access Key",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
<<<<<<< HEAD
        -1376,
        -720
=======
        -2688,
        -496
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://localhost:5678/webhook/login",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "email",
<<<<<<< HEAD
              "value": "={{ $('Webhook1').item.json.body.email }}"
            },
            {
              "name": "identifier",
              "value": "={{ $('Webhook1').item.json.body.identifier }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "id": "3a84b816-7545-41da-8ac4-ce14a1737800",
=======
              "value": "=$json.body.email"
            },
            {
              "name": "identifier",
              "value": "$json.body['access-key'] || $json.body.accessKey"
            }
          ]
        },
        "options": {}
      },
      "id": "efc935e3-3c05-4c23-a435-3589dc0b56c9",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Check Login",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
<<<<<<< HEAD
        -1216,
        -720
=======
        -2528,
        -496
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json.isAccessKeyValid}}",
              "value2": true
            }
          ]
        }
      },
<<<<<<< HEAD
      "id": "8cd24702-0b94-4142-bb40-844ce5e236d6",
=======
      "id": "8dec8072-de82-4e04-9830-e47ad970ce69",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Is Authorized?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
<<<<<<< HEAD
        -1056,
        -720
=======
        -2368,
        -496
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f0c96b8f-cde2-488d-9865-816e528c6162",
              "name": "session_data",
              "value": "={{ JSON.parse($json.data) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
<<<<<<< HEAD
        -704,
        -1008
      ],
      "id": "e2726ad1-3c89-4646-875f-62c8c12b6493",
=======
        -2016,
        -784
      ],
      "id": "e5151f25-688e-4341-9cc6-80ceb929fb2b",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Parse Session JSON"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
<<<<<<< HEAD
        -320,
        -752
      ],
      "id": "c588b3c3-3053-4079-8a81-d468db14d757",
=======
        -1632,
        -528
      ],
      "id": "5bca0085-5557-4ab2-aff4-6e517819f96f",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "Merge1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "9cb1eacd-867d-4b62-b820-678271ca55f3",
              "leftValue": "={{$json.choices[0].message.content}}",
              "rightValue": "COMPLETO",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
<<<<<<< HEAD
        480,
        48
      ],
      "id": "b5eaddaf-5112-4ab4-b7cf-ebfe9dc88fa6",
=======
        -832,
        272
      ],
      "id": "e0449569-697d-48d1-864b-44f80cddea7d",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "If"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://localhost:5678/webhook/gerar-documentos",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "sessionId",
<<<<<<< HEAD
              "value": "={{ $json.sessionId }}"
            },
            {
              "name": "dados_coletados",
              "value": "={{ JSON.stringify($json.collected_data) }}"
            },
            {
              "name": "history",
              "value": "={{ JSON.stringify($json.history) }}"
=======
              "value": "={{ $json.session_data.sessionId }}"
            },
            {
              "name": "dados_coletados",
              "value": "={{ $json.session_data.collected_data }}"
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
<<<<<<< HEAD
        752,
        208
      ],
      "id": "a7a22c6e-c25c-415e-bd3b-bd9c1656ba01",
=======
        -1744,
        32
      ],
      "id": "99ec6f08-e1d2-40ae-b289-d80405dc9dd6",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
<<<<<<< HEAD
              "id": "ac9e6f35-62bb-499d-bd5c-4a08e1e7be26",
              "name": "resposta_chatbot",
              "value": "Perfeito! Coletei todas as informações necessárias. Estou gerando seu Business Case agora...",
=======
              "id": "67b9365e-26f5-46aa-83a3-b67484347710",
              "name": "resposta_chatbot",
              "value": "Obrigado! Todas as informações necessárias foram coletadas com sucesso. Em breve, o draft do seu Business Case será gerado.",
              "type": "string"
            },
            {
              "id": "c13812ee-90c7-43ca-ac0e-436f6d0f507b",
              "name": "last_question",
              "value": "completed",
              "type": "string"
            },
            {
              "id": "e003058a-493e-4340-9856-621f20d778d9",
              "name": "status",
              "value": "completed",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
              "type": "string"
            },
            {
              "id": "b8f3c9d1-1a2e-4f5b-9c8d-7e6a5f4b3c2d",
              "name": "status",
              "value": "completed",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "38cb6c40-2419-4fe6-8eb8-6ac44f6a5072",
      "name": "All Questions Answered",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        656,
        48
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://localhost:5678/webhook/registrar-log",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "sessionId",
              "value": "={{ $json.body.sessionId }}"
            },
            {
              "name": "event_type",
              "value": "chatbot_interaction"
            },
            {
              "name": "message",
              "value": "={{ $json.body.message }}"
            },
            {
              "name": "response",
              "value": "={{ $json.resposta_chatbot }}"
            },
            {
              "name": "status",
              "value": "={{ $json.status || 'collecting' }}"
            }
          ]
        },
        "options": {}
      },
<<<<<<< HEAD
      "id": "c148452e-055b-489e-b82f-ed7b6445b0a6",
      "name": "Log Interaction",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        704,
        -544
=======
      "id": "2e4f809e-8344-4e78-81ab-e82ca2ca8f98",
      "name": "All Questions Answered",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1952,
        32
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ]
    },
    {
      "parameters": {
<<<<<<< HEAD
        "mode": "combine",
        "options": {}
      },
      "id": "d0c76fef-3b24-4847-8563-a34f04614062",
      "name": "Merge Webhook Data",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        704,
        -400
=======
        "method": "POST",
        "url": "http://localhost:5678/webhook/registrar-log",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "sessionId",
              "value": "={{ $json.session_data.sessionId }}"
            },
            {
              "name": "event_type",
              "value": "chatbot_interaction"
            },
            {
              "name": "message",
              "value": "={{ $json.body.message }}"
            },
            {
              "name": "response",
              "value": "={{ $json.resposta_chatbot }}"
            },
            {
              "name": "status",
              "value": "={{ $json.status }}"
            }
          ]
        },
        "options": {}
      },
      "id": "46147e22-37af-4af3-8e74-7a3b95aac1fc",
      "name": "Log Interaction",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -832,
        -112
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
      ]
    }
  ],
  "pinData": {},
  "connections": {
    "Set Complementary Question": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Status Collecting Complementary?": {
      "main": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check Setor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Session from Redis": {
      "main": [
        [
          {
            "node": "Parse Session JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is New Conversation?": {
      "main": [
        [
          {
            "node": "Create Session and Ask First Question",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Merge Webhook Data",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Interaction",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Interaction": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ask Resultado": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ask Problema": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ask Tamanho": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Ask Setor": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update with Answer": {
      "main": [
        [
          {
            "node": "Is Status Collecting Complementary?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Session and Ask First Question": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Setor": {
      "main": [
        [
          {
            "node": "Ask Setor",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check Tamanho",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Tamanho": {
      "main": [
        [
          {
            "node": "Ask Tamanho",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check Problema",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Problema": {
      "main": [
        [
          {
            "node": "Ask Problema",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check Resultado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Resultado": {
      "main": [
        [
          {
            "node": "Ask Resultado",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook1": {
      "main": [
        [
          {
            "node": "Extract Access Key",
<<<<<<< HEAD
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge Webhook Data",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Extract Access Key": {
      "main": [
        [
          {
            "node": "Check Login",
=======
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
<<<<<<< HEAD
=======
    "Extract Access Key": {
      "main": [
        [
          {
            "node": "Check Login",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
    "Check Login": {
      "main": [
        [
          {
            "node": "Is Authorized?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Is Authorized?": {
      "main": [
        [
          {
            "node": "Get Session from Redis",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Parse Session JSON": {
      "main": [
        [
          {
            "node": "Is New Conversation?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Update with Answer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "All Questions Answered",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Complementary Question",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
<<<<<<< HEAD
    "All Questions Answered": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          },
          {
=======
    "HTTP Request": {
      "main": [
        [
          {
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
<<<<<<< HEAD
    "Log Interaction": {
      "main": [
        [
          {
            "node": "Save Session to Redis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Webhook Data": {
      "main": [
        [
          {
            "node": "Log Interaction",
=======
    "All Questions Answered": {
      "main": [
        [
          {
            "node": "HTTP Request",
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "b1a70d36-8e57-4542-b1dc-5e0094d0a868",
  "meta": {
    "templateCredsSetupCompleted": true,
<<<<<<< HEAD
    "instanceId": "81ba944ac1e7c5de6f553e387cbe193e89cfad3c1e08428a664aa51a90567403"
  }
=======
    "instanceId": "5576f8658144d927e9db95b1d92cb09570b444ab6ed310e6a1fa939b917c4013"
  },
  "id": "h8Yg5IiKac1PCCid",
  "tags": []
>>>>>>> 7269198780bf0af60938327ce144d3094a9f8b5a
}